<!DOCTYPE html>

<html>
    <head>
		<title>Trouvetavierge.com</title>
        <link rel="stylesheet" type="text/css" href="pageaccueil.css">
		<?php if (!isset($_SESSION['utilisateur']) && isset($_COOKIE['rememberme'])) {
			$token = $_COOKIE['rememberme'];
		
			// Vérifiez le token
			if (isset($_SESSION['token']) && $_SESSION['token'] === $token) {
				// Token valide, recréer la session utilisateur
				// Vous pouvez également ajouter des vérifications supplémentaires ici
			} else {
				// Token invalide, supprimer le cookie
				setcookie('rememberme', '', time() - 3600, "/");
			}
		}
		?>
    </head>
	
    <body>
		<nav id="menu">
			<ul>
				<li><a href="Pageprofil.html">Profil</a></li>
				<li><a href="Pageabonnement.html">Abonnement</a></li>
				<li><a href="Pagearecherche.html">Recherche</a></li>
				<li><a href="Pagemessagerie.html">Messagerie</a></li>
				<li><a href="#">Deconnexion</a></li>
			</ul>
		</nav>

		<a id="image" href="pagederecherche.html"> <img src="Constellation.png" alt="Tourne la roue et trouve ton étoile"/> </a>
		<h2>Voici les récentes inscriptions sur notre site</h2>
		<div id="elements">

		</div>
		<script>
        
			var xhr = new XMLHttpRequest();
			xhr.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
					var utilisateurs = JSON.parse(xhr.response); // Utilisez xhr.response directement
					console.log(utilisateurs);
		
		
					
		
					utilisateurs.forEach(element => {
						var utilisateurDiv = document.createElement('div');
			utilisateurDiv.innerHTML = `
							Pseudo: ${element.Pseudo}<br>
							Sexe: ${element.Sexe}<br>
							Date d'inscription: ${element.Date_inscription}<br>
							Profession: ${element.Profession}<br>
							Ville: ${element.Ville}<br>
							Description: ${element.Description}
						`;
						var div=document.getElementById("elements");
						div.appendChild(utilisateurDiv);

						var profilLien = document.createElement('a');
                    profilLien.href = 'pageprofil.html?user=' + encodeURIComponent(element.Pseudo);
                    profilLien.appendChild(utilisateurDiv);

                    // Ajouter le lien au conteneur
                    var div = document.getElementById("elements");
            div.appendChild(profilLien);
					}); 
						
		}
		
			
		
					
		
				
			};
			xhr.open("GET", "20utilisateurs.php", true);
			xhr.send();
		
		
			</script>
    </body>
</html>
